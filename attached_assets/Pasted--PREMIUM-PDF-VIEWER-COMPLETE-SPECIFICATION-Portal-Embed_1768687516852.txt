# PREMIUM PDF VIEWER - COMPLETE SPECIFICATION

## Portal Embedded PDF Experience with AI Chatbot

-----

## OVERVIEW

This spec includes:

- **Phase 1:** Core viewer (embedded, dark mode, mobile, progress syncing)
- **Phase 2:** Premium features (bookmarks, highlights, reading time, completion tracking)
- **AI Chatbot:** Existing chatbot connected to PDF content (context-aware)

All features are implementable NOW (not â€œlaterâ€).

-----

## TECHNICAL FOUNDATION

### **PDF.js Viewer (Base Layer)**

```html
<!-- Portal PDF Page Structure -->
<div class="portal-pdf-container">
  
  <!-- Left: PDF Viewer -->
  <div class="pdf-viewer-section">
    
    <!-- Header with reading stats -->
    <div class="pdf-header">
      <h2>90-Day Quick-Start System</h2>
      <div class="pdf-stats">
        <span class="reading-time">ğŸ“– ~35 min read</span>
        <span class="completion">67% complete</span>
      </div>
    </div>
    
    <!-- Shimmer loading (shows while PDF loads) -->
    <div class="pdf-skeleton" id="loading-skeleton">
      <div class="shimmer"></div>
      <div class="shimmer"></div>
      <div class="shimmer"></div>
    </div>
    
    <!-- PDF.js viewer iframe -->
    <iframe 
      id="pdf-viewer"
      src="/pdfjs/web/viewer.html?file=/assets/quick-start.pdf"
      style="display: none;"
    ></iframe>
    
    <!-- Controls below viewer -->
    <div class="pdf-controls">
      <button class="bookmark-page">ğŸ”– Bookmark This Page</button>
      <button class="download-pdf">â¬‡ Download PDF</button>
    </div>
    
  </div>
  
  <!-- Right: AI Chatbot Sidebar -->
  <div class="ai-chatbot-sidebar">
    <div class="chatbot-header">
      <h3>Ask About This Document</h3>
      <p>I can answer questions about the Quick-Start System</p>
    </div>
    
    <div class="chatbot-messages" id="chat-messages">
      <!-- Messages appear here -->
    </div>
    
    <div class="chatbot-input">
      <textarea 
        id="chat-input" 
        placeholder="Ask a question about this PDF..."
      ></textarea>
      <button id="chat-send">Send</button>
    </div>
  </div>
  
</div>

<!-- Bookmarks Sidebar (toggleable) -->
<div class="bookmarks-panel" id="bookmarks-panel">
  <h3>Your Bookmarks</h3>
  <div id="bookmarks-list">
    <!-- Bookmarks appear here -->
  </div>
</div>

<!-- Highlights Panel (toggleable) -->
<div class="highlights-panel" id="highlights-panel">
  <h3>Your Highlights</h3>
  <div id="highlights-list">
    <!-- Highlights appear here -->
  </div>
</div>
```

-----

## FEATURE 1: PROGRESS SYNCING

### **What It Does:**

- Saves userâ€™s scroll position in PDF
- Restores exact position when they return
- Works across devices (if using database storage)
- Shows completion percentage

### **Implementation:**

```javascript
// Save progress to database
const saveProgress = async (pageNumber, totalPages) => {
  const progress = {
    userId: currentUser.id,
    documentId: 'quick-start',
    currentPage: pageNumber,
    totalPages: totalPages,
    percentComplete: Math.round((pageNumber / totalPages) * 100),
    lastAccessed: new Date().toISOString()
  };
  
  // Save to database
  await fetch('/api/user-progress', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(progress)
  });
  
  // Update UI
  document.querySelector('.completion').textContent = 
    `${progress.percentComplete}% complete`;
};

// Track page changes
pdfViewer.addEventListener('pagechange', (e) => {
  const currentPage = e.pageNumber;
  const totalPages = pdfViewer.pagesCount;
  saveProgress(currentPage, totalPages);
});

// Restore progress on load
const restoreProgress = async () => {
  const response = await fetch(
    `/api/user-progress?userId=${currentUser.id}&documentId=quick-start`
  );
  const progress = await response.json();
  
  if (progress && progress.currentPage) {
    pdfViewer.currentPageNumber = progress.currentPage;
    document.querySelector('.completion').textContent = 
      `${progress.percentComplete}% complete`;
  }
};

// Call on page load
window.addEventListener('load', restoreProgress);
```

### **Database Schema:**

```sql
CREATE TABLE user_progress (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50), -- 'quick-start' or 'archive'
  current_page INTEGER,
  total_pages INTEGER,
  percent_complete INTEGER,
  last_accessed TIMESTAMP,
  UNIQUE(user_id, document_id)
);
```

-----

## FEATURE 2: DARK MODE VIEWER

### **What It Does:**

- PDF viewer matches dark landing page aesthetic
- Not blinding white background
- Preserves image/diagram colors

### **Implementation:**

```css
/* Dark mode for PDF viewer */
.pdfViewer {
  background: #0a0a0a !important;
  filter: invert(0.9) hue-rotate(180deg);
}

/* Fix images (don't invert) */
.pdfViewer img,
.pdfViewer canvas {
  filter: invert(1) hue-rotate(180deg);
}

/* Viewer chrome (controls) */
#toolbarContainer {
  background: #1a1a1a !important;
  border-bottom: 1px solid #333 !important;
}

#toolbarViewer button {
  color: #14B8A6 !important;
}

#toolbarViewer button:hover {
  background: rgba(20, 184, 166, 0.1) !important;
}
```

-----

## FEATURE 3: SHIMMER LOADING

### **What It Does:**

- Shows shimmer skeleton while PDF loads
- No grey spinner or blank space
- Premium loading experience

### **Implementation:**

```html
<!-- Loading skeleton -->
<div class="pdf-skeleton" id="loading-skeleton">
  <div class="shimmer"></div>
  <div class="shimmer"></div>
  <div class="shimmer"></div>
</div>
```

```css
.pdf-skeleton {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 20px;
}

.shimmer {
  height: 200px;
  background: linear-gradient(
    90deg,
    #1a1a1a 25%,
    #2a2a2a 50%,
    #1a1a1a 75%
  );
  background-size: 200% 100%;
  animation: shimmer 2s infinite;
  border-radius: 8px;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
```

```javascript
// Hide skeleton when PDF loads
pdfViewer.addEventListener('documentloaded', () => {
  document.getElementById('loading-skeleton').style.display = 'none';
  document.getElementById('pdf-viewer').style.display = 'block';
});
```

-----

## FEATURE 4: DOWNLOAD TRACKING

### **What It Does:**

- Tracks when users download PDF
- Logs to database for analytics
- Shows download count

### **Implementation:**

```javascript
// Track downloads
document.querySelector('.download-pdf').addEventListener('click', async () => {
  // Log download event
  await fetch('/api/track-download', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      userId: currentUser.id,
      documentId: 'quick-start',
      timestamp: new Date().toISOString()
    })
  });
  
  // Trigger download
  const link = document.createElement('a');
  link.href = '/assets/quick-start.pdf';
  link.download = 'The-Archivist-Method-Quick-Start.pdf';
  link.click();
});
```

### **Database Schema:**

```sql
CREATE TABLE download_logs (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  timestamp TIMESTAMP
);
```

-----

## FEATURE 5: MOBILE OPTIMIZATION

### **What It Does:**

- Single-page mode on mobile (no side-by-side pages)
- Auto-scales to screen width (no horizontal scroll)
- Touch-friendly controls
- Hides chatbot on mobile (or makes it collapsible)

### **Implementation:**

```javascript
// Mobile optimizations
const optimizeForMobile = () => {
  if (window.innerWidth < 768) {
    // Single page mode
    PDFViewerApplication.pdfViewer.spreadMode = 0;
    
    // Scale to fit width
    PDFViewerApplication.pdfViewer.currentScaleValue = 'page-width';
    
    // Hide chatbot sidebar on mobile
    document.querySelector('.ai-chatbot-sidebar').style.display = 'none';
    
    // Add "Show Chat" button
    const chatToggle = document.createElement('button');
    chatToggle.className = 'mobile-chat-toggle';
    chatToggle.textContent = 'ğŸ’¬ Ask Questions';
    chatToggle.onclick = toggleChatMobile;
    document.querySelector('.pdf-header').appendChild(chatToggle);
  }
};

// Toggle chat on mobile (fullscreen overlay)
const toggleChatMobile = () => {
  const chatSidebar = document.querySelector('.ai-chatbot-sidebar');
  chatSidebar.classList.toggle('mobile-active');
};

// Run on load and resize
window.addEventListener('load', optimizeForMobile);
window.addEventListener('resize', optimizeForMobile);
```

```css
/* Mobile chat overlay */
@media (max-width: 768px) {
  .ai-chatbot-sidebar {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100%;
    height: 100vh;
    background: #0a0a0a;
    z-index: 1000;
    transition: right 0.3s ease;
  }
  
  .ai-chatbot-sidebar.mobile-active {
    right: 0;
  }
  
  .mobile-chat-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #14B8A6;
    color: white;
    padding: 12px 20px;
    border-radius: 24px;
    border: none;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(20, 184, 166, 0.4);
  }
}
```

-----

## FEATURE 6: PAGE BOOKMARKS (PHASE 2)

### **What It Does:**

- User clicks â€œBookmark This Pageâ€
- Page is saved to their account
- Sidebar shows all bookmarks
- Click bookmark â†’ Jump to that page

### **Implementation:**

```javascript
// Add bookmark
const addBookmark = async () => {
  const currentPage = pdfViewer.currentPageNumber;
  const pageLabel = pdfViewer.currentPageLabel || `Page ${currentPage}`;
  
  const bookmark = {
    userId: currentUser.id,
    documentId: 'quick-start',
    pageNumber: currentPage,
    pageLabel: pageLabel,
    note: prompt('Add a note (optional):') || '',
    createdAt: new Date().toISOString()
  };
  
  // Save to database
  await fetch('/api/bookmarks', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(bookmark)
  });
  
  // Refresh bookmarks list
  loadBookmarks();
  
  // Show confirmation
  showToast('Bookmark added!');
};

// Load bookmarks
const loadBookmarks = async () => {
  const response = await fetch(
    `/api/bookmarks?userId=${currentUser.id}&documentId=quick-start`
  );
  const bookmarks = await response.json();
  
  const bookmarksList = document.getElementById('bookmarks-list');
  bookmarksList.innerHTML = '';
  
  bookmarks.forEach(bookmark => {
    const item = document.createElement('div');
    item.className = 'bookmark-item';
    item.innerHTML = `
      <div class="bookmark-page">${bookmark.pageLabel}</div>
      <div class="bookmark-note">${bookmark.note}</div>
      <button onclick="jumpToPage(${bookmark.pageNumber})">
        Go to Page
      </button>
      <button onclick="deleteBookmark(${bookmark.id})">
        Delete
      </button>
    `;
    bookmarksList.appendChild(item);
  });
};

// Jump to bookmarked page
const jumpToPage = (pageNumber) => {
  pdfViewer.currentPageNumber = pageNumber;
};

// Attach to button
document.querySelector('.bookmark-page').addEventListener('click', addBookmark);
```

### **Database Schema:**

```sql
CREATE TABLE bookmarks (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  page_number INTEGER,
  page_label VARCHAR(50),
  note TEXT,
  created_at TIMESTAMP
);
```

### **UI Design:**

```css
.bookmarks-panel {
  position: fixed;
  right: -300px;
  top: 80px;
  width: 300px;
  height: calc(100vh - 100px);
  background: #1a1a1a;
  border-left: 1px solid #333;
  padding: 20px;
  transition: right 0.3s ease;
  overflow-y: auto;
}

.bookmarks-panel.open {
  right: 0;
}

.bookmark-item {
  background: #0d0d0d;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 8px;
  border: 1px solid #333;
}

.bookmark-page {
  color: #14B8A6;
  font-weight: 600;
  margin-bottom: 4px;
}

.bookmark-note {
  color: #d1d5db;
  font-size: 14px;
  margin-bottom: 8px;
}

.bookmark-item button {
  background: transparent;
  color: #14B8A6;
  border: 1px solid #14B8A6;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  margin-right: 8px;
  cursor: pointer;
}

.bookmark-item button:hover {
  background: #14B8A6;
  color: white;
}
```

-----

## FEATURE 7: TEXT HIGHLIGHTS (PHASE 2)

### **What It Does:**

- User selects text in PDF
- Clicks â€œHighlightâ€ button
- Text is highlighted (colored background)
- Saved to database
- Persists across sessions
- Shows all highlights in sidebar

### **Implementation:**

```javascript
// Enable text selection highlighting
const enableHighlighting = () => {
  // Listen for text selection
  document.addEventListener('mouseup', () => {
    const selection = window.getSelection();
    const selectedText = selection.toString().trim();
    
    if (selectedText.length > 0) {
      showHighlightButton(selection);
    }
  });
};

// Show highlight button near selection
const showHighlightButton = (selection) => {
  const range = selection.getRangeAt(0);
  const rect = range.getBoundingClientRect();
  
  // Create highlight button
  let button = document.getElementById('highlight-button');
  if (!button) {
    button = document.createElement('button');
    button.id = 'highlight-button';
    button.className = 'highlight-popup-button';
    button.textContent = 'ğŸ– Highlight';
    document.body.appendChild(button);
  }
  
  // Position near selection
  button.style.top = `${rect.top - 40}px`;
  button.style.left = `${rect.left}px`;
  button.style.display = 'block';
  
  // Handle click
  button.onclick = () => saveHighlight(selection);
};

// Save highlight
const saveHighlight = async (selection) => {
  const selectedText = selection.toString().trim();
  const range = selection.getRangeAt(0);
  
  const highlight = {
    userId: currentUser.id,
    documentId: 'quick-start',
    pageNumber: pdfViewer.currentPageNumber,
    text: selectedText,
    color: '#FFD700', // Yellow highlight
    position: {
      start: range.startOffset,
      end: range.endOffset
    },
    createdAt: new Date().toISOString()
  };
  
  // Save to database
  await fetch('/api/highlights', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(highlight)
  });
  
  // Apply highlight visually
  applyHighlight(range, highlight.color);
  
  // Hide button
  document.getElementById('highlight-button').style.display = 'none';
  
  // Refresh highlights list
  loadHighlights();
  
  showToast('Text highlighted!');
};

// Apply visual highlight
const applyHighlight = (range, color) => {
  const span = document.createElement('span');
  span.className = 'user-highlight';
  span.style.backgroundColor = color;
  range.surroundContents(span);
};

// Load saved highlights on page load
const loadHighlights = async () => {
  const response = await fetch(
    `/api/highlights?userId=${currentUser.id}&documentId=quick-start`
  );
  const highlights = await response.json();
  
  // Display in sidebar
  const highlightsList = document.getElementById('highlights-list');
  highlightsList.innerHTML = '';
  
  highlights.forEach(highlight => {
    const item = document.createElement('div');
    item.className = 'highlight-item';
    item.innerHTML = `
      <div class="highlight-text">"${highlight.text}"</div>
      <div class="highlight-page">Page ${highlight.pageNumber}</div>
      <button onclick="jumpToPage(${highlight.pageNumber})">
        Go to Page
      </button>
      <button onclick="deleteHighlight(${highlight.id})">
        Delete
      </button>
    `;
    highlightsList.appendChild(item);
  });
  
  // Re-apply highlights to PDF
  highlights.forEach(highlight => {
    // Re-highlight text on current page
    // (This requires more complex range calculation)
  });
};

// Initialize
enableHighlighting();
window.addEventListener('load', loadHighlights);
```

### **Database Schema:**

```sql
CREATE TABLE highlights (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  page_number INTEGER,
  text TEXT,
  color VARCHAR(20),
  position JSONB,
  created_at TIMESTAMP
);
```

### **UI Design:**

```css
.highlight-popup-button {
  position: absolute;
  background: #14B8A6;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(20, 184, 166, 0.4);
  z-index: 1000;
  display: none;
}

.user-highlight {
  background-color: rgba(255, 215, 0, 0.3);
  padding: 2px 0;
}

.highlights-panel {
  position: fixed;
  left: -300px;
  top: 80px;
  width: 300px;
  height: calc(100vh - 100px);
  background: #1a1a1a;
  border-right: 1px solid #333;
  padding: 20px;
  transition: left 0.3s ease;
  overflow-y: auto;
}

.highlights-panel.open {
  left: 0;
}

.highlight-item {
  background: #0d0d0d;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 8px;
  border-left: 4px solid #FFD700;
}

.highlight-text {
  color: #d1d5db;
  font-size: 14px;
  font-style: italic;
  margin-bottom: 8px;
}

.highlight-page {
  color: #14B8A6;
  font-size: 12px;
  margin-bottom: 8px;
}
```

-----

## FEATURE 8: READING TIME ESTIMATE (PHASE 2)

### **What It Does:**

- Calculates estimated reading time based on:
  - Total pages
  - Average words per page
  - Average reading speed (250 words/min)
- Shows in header: â€œğŸ“– ~35 min readâ€

### **Implementation:**

```javascript
// Calculate reading time
const calculateReadingTime = async () => {
  const response = await fetch(`/api/document-stats?documentId=quick-start`);
  const stats = await response.json();
  
  const totalWords = stats.totalWords || 11750; // ~250 words/page * 47 pages
  const wordsPerMinute = 250;
  const readingMinutes = Math.ceil(totalWords / wordsPerMinute);
  
  // Display
  document.querySelector('.reading-time').textContent = 
    `ğŸ“– ~${readingMinutes} min read`;
};

// Call on load
window.addEventListener('load', calculateReadingTime);
```

### **Pre-calculated (Simpler Option):**

```javascript
// Hard-code reading time per document
const readingTimes = {
  'quick-start': 35, // 47 pages * ~0.75 min/page
  'archive': 90      // Longer document
};

document.querySelector('.reading-time').textContent = 
  `ğŸ“– ~${readingTimes['quick-start']} min read`;
```

-----

## FEATURE 9: COMPLETION TRACKING (PHASE 2)

### **What It Does:**

- Tracks pages user has viewed
- Calculates percentage complete
- Shows progress bar in portal
- Updates in real-time

### **Implementation:**

```javascript
// Track viewed pages
const viewedPages = new Set();

pdfViewer.addEventListener('pagechange', (e) => {
  const pageNumber = e.pageNumber;
  viewedPages.add(pageNumber);
  
  const totalPages = pdfViewer.pagesCount;
  const percentComplete = Math.round((viewedPages.size / totalPages) * 100);
  
  // Update UI
  updateCompletionUI(percentComplete, viewedPages.size, totalPages);
  
  // Save to database
  saveCompletion(percentComplete, Array.from(viewedPages));
});

// Update completion UI
const updateCompletionUI = (percent, viewed, total) => {
  document.querySelector('.completion').textContent = 
    `${percent}% complete`;
  
  // Progress bar
  const progressBar = document.querySelector('.progress-bar-fill');
  if (progressBar) {
    progressBar.style.width = `${percent}%`;
  }
  
  // Badge if 100%
  if (percent === 100) {
    showCompletionBadge();
  }
};

// Save to database
const saveCompletion = async (percent, pagesViewed) => {
  await fetch('/api/user-completion', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      userId: currentUser.id,
      documentId: 'quick-start',
      percentComplete: percent,
      pagesViewed: pagesViewed,
      lastAccessed: new Date().toISOString()
    })
  });
};

// Show completion badge
const showCompletionBadge = () => {
  const badge = document.createElement('div');
  badge.className = 'completion-badge';
  badge.innerHTML = `
    <div class="badge-icon">ğŸ‰</div>
    <div class="badge-text">
      <h3>Quick-Start Complete!</h3>
      <p>You've viewed all 47 pages</p>
    </div>
  `;
  document.body.appendChild(badge);
  
  setTimeout(() => {
    badge.classList.add('show');
  }, 100);
  
  // Remove after 5 seconds
  setTimeout(() => {
    badge.classList.remove('show');
    setTimeout(() => badge.remove(), 300);
  }, 5000);
};
```

### **Progress Bar UI:**

```html
<div class="pdf-progress">
  <div class="progress-bar">
    <div class="progress-bar-fill" style="width: 67%;"></div>
  </div>
  <span class="completion">67% complete</span>
</div>
```

```css
.pdf-progress {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 12px;
}

.progress-bar {
  flex: 1;
  height: 8px;
  background: #1a1a1a;
  border-radius: 4px;
  overflow: hidden;
}

.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, #14B8A6, #10b981);
  transition: width 0.3s ease;
}

.completion-badge {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: #1a1a1a;
  border: 2px solid #14B8A6;
  padding: 40px;
  border-radius: 16px;
  text-align: center;
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 2000;
}

.completion-badge.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

.badge-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.badge-text h3 {
  color: #14B8A6;
  margin-bottom: 8px;
}

.badge-text p {
  color: #d1d5db;
}
```

### **Database Schema:**

```sql
CREATE TABLE user_completion (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  percent_complete INTEGER,
  pages_viewed INTEGER[],
  last_accessed TIMESTAMP,
  UNIQUE(user_id, document_id)
);
```

-----

## FEATURE 10: AI CHATBOT INTEGRATION

### **What It Does:**

- Existing AI chatbot (already built for portal)
- Connected to PDF content (context-aware)
- User asks questions about the document
- AI answers based on PDF content
- Highlights relevant sections

### **Implementation:**

```javascript
// Send message to AI chatbot
const sendChatMessage = async () => {
  const input = document.getElementById('chat-input');
  const message = input.value.trim();
  
  if (!message) return;
  
  // Add user message to chat
  addMessageToChat('user', message);
  
  // Clear input
  input.value = '';
  
  // Get current PDF context
  const currentPage = pdfViewer.currentPageNumber;
  const documentId = 'quick-start';
  
  // Send to AI (using your existing chatbot endpoint)
  const response = await fetch('/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      message: message,
      context: {
        documentId: documentId,
        currentPage: currentPage,
        userId: currentUser.id
      }
    })
  });
  
  const data = await response.json();
  
  // Add AI response to chat
  addMessageToChat('assistant', data.message);
  
  // If AI references specific pages, highlight them
  if (data.referencedPages) {
    highlightReferencedPages(data.referencedPages);
  }
};

// Add message to chat UI
const addMessageToChat = (role, content) => {
  const messagesContainer = document.getElementById('chat-messages');
  
  const messageDiv = document.createElement('div');
  messageDiv.className = `chat-message ${role}`;
  messageDiv.innerHTML = `
    <div class="message-avatar">
      ${role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}
    </div>
    <div class="message-content">
      ${content}
    </div>
  `;
  
  messagesContainer.appendChild(messageDiv);
  
  // Scroll to bottom
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
};

// Highlight pages AI references
const highlightReferencedPages = (pages) => {
  // Example: pages = [15, 23, 34]
  pages.forEach(page => {
    // Add visual indicator that AI referenced this page
    const pageElement = document.querySelector(`[data-page="${page}"]`);
    if (pageElement) {
      pageElement.classList.add('ai-referenced');
    }
  });
};

// Attach to send button
document.getElementById('chat-send').addEventListener('click', sendChatMessage);

// Enter key to send
document.getElementById('chat-input').addEventListener('keypress', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendChatMessage();
  }
});
```

### **AI Context (Backend):**

Your existing AI chatbot needs PDF content as context:

```javascript
// Backend: /api/chat endpoint
app.post('/api/chat', async (req, res) => {
  const { message, context } = req.body;
  
  // Load PDF content for context
  const pdfContent = await loadPDFContent(context.documentId);
  
  // Get relevant sections based on current page
  const relevantContent = pdfContent.pages[context.currentPage - 1];
  
  // Send to Claude API with PDF context
  const aiResponse = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': process.env.ANTHROPIC_API_KEY,
      'anthropic-version': '2023-06-01'
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 1000,
      messages: [
        {
          role: 'user',
          content: `You are a helpful assistant for The Archivist Method. 
          
          The user is reading the Quick-Start System PDF (page ${context.currentPage}).
          
          Here's the content from the current page:
          ${relevantContent}
          
          User question: ${message}
          
          Answer based on the PDF content. Be specific and reference page numbers if relevant.`
        }
      ]
    })
  });
  
  const data = await aiResponse.json();
  
  res.json({
    message: data.content[0].text,
    referencedPages: extractPageReferences(data.content[0].text)
  });
});
```

### **AI Chatbot UI:**

```css
.ai-chatbot-sidebar {
  width: 400px;
  background: #1a1a1a;
  border-left: 1px solid #333;
  display: flex;
  flex-direction: column;
  height: 100vh;
  position: sticky;
  top: 0;
}

.chatbot-header {
  padding: 20px;
  border-bottom: 1px solid #333;
}

.chatbot-header h3 {
  color: #14B8A6;
  margin-bottom: 8px;
}

.chatbot-header p {
  color: #9ca3af;
  font-size: 14px;
}

.chatbot-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.chat-message {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
}

.chat-message.user {
  flex-direction: row-reverse;
}

.message-avatar {
  font-size: 24px;
  flex-shrink: 0;
}

.message-content {
  background: #0d0d0d;
  padding: 12px 16px;
  border-radius: 12px;
  color: #d1d5db;
  line-height: 1.6;
  max-width: 80%;
}

.chat-message.user .message-content {
  background: #14B8A6;
  color: white;
}

.chatbot-input {
  padding: 20px;
  border-top: 1px solid #333;
  display: flex;
  gap: 12px;
}

.chatbot-input textarea {
  flex: 1;
  background: #0d0d0d;
  border: 1px solid #333;
  border-radius: 8px;
  padding: 12px;
  color: #d1d5db;
  font-family: 'Inter', sans-serif;
  resize: none;
  height: 60px;
}

.chatbot-input button {
  background: #14B8A6;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

.chatbot-input button:hover {
  background: #10b981;
}
```

-----

## COMPLETE LAYOUT (Desktop)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PORTAL HEADER                              [User] [Logout] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  [Sidebar]    [PDF Viewer]           [AI Chatbot]        â”‚
â”‚                                                            â”‚
â”‚  â€¢ Analysis   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â€¢ Course     â”‚ Quick-Start    â”‚    â”‚ Ask About    â”‚    â”‚
â”‚  â†’ Quick      â”‚ System         â”‚    â”‚ This Doc     â”‚    â”‚
â”‚    Start      â”‚                â”‚    â”‚              â”‚    â”‚
â”‚  â€¢ Archive    â”‚ ğŸ“– ~35 min     â”‚    â”‚ ğŸ’¬ [Chat]    â”‚    â”‚
â”‚               â”‚ 67% complete   â”‚    â”‚              â”‚    â”‚
â”‚  [Bookmarks]  â”‚                â”‚    â”‚ User: How do â”‚    â”‚
â”‚  [Highlights] â”‚ [PDF renders   â”‚    â”‚ I identify   â”‚    â”‚
â”‚               â”‚  here with     â”‚    â”‚ my body      â”‚    â”‚
â”‚               â”‚  dark mode]    â”‚    â”‚ signature?   â”‚    â”‚
â”‚               â”‚                â”‚    â”‚              â”‚    â”‚
â”‚               â”‚ Page 15 of 47  â”‚    â”‚ AI: On page  â”‚    â”‚
â”‚               â”‚                â”‚    â”‚ 12, you'll   â”‚    â”‚
â”‚               â”‚ [ğŸ”– Bookmark]  â”‚    â”‚ find...      â”‚    â”‚
â”‚               â”‚ [â¬‡ Download]   â”‚    â”‚              â”‚    â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

-----

## MOBILE LAYOUT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PORTAL      [Menu]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Quick-Start System     â”‚
â”‚ ğŸ“– ~35 min â€¢ 67% done  â”‚
â”‚                        â”‚
â”‚ [Progress Bar]         â”‚
â”‚                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                    â”‚ â”‚
â”‚ â”‚ [PDF Full Width]   â”‚ â”‚
â”‚ â”‚                    â”‚ â”‚
â”‚ â”‚ Page 15 of 47      â”‚ â”‚
â”‚ â”‚                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚
â”‚ [ğŸ”–] [â¬‡] [ğŸ’¬ Ask]     â”‚
â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Chat opens as fullscreen overlay when user taps ğŸ’¬]
```

-----

## DATABASE SCHEMAS (Complete)

```sql
-- User progress
CREATE TABLE user_progress (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  current_page INTEGER,
  total_pages INTEGER,
  percent_complete INTEGER,
  last_accessed TIMESTAMP,
  UNIQUE(user_id, document_id)
);

-- Bookmarks
CREATE TABLE bookmarks (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  page_number INTEGER,
  page_label VARCHAR(50),
  note TEXT,
  created_at TIMESTAMP
);

-- Highlights
CREATE TABLE highlights (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  page_number INTEGER,
  text TEXT,
  color VARCHAR(20),
  position JSONB,
  created_at TIMESTAMP
);

-- Completion tracking
CREATE TABLE user_completion (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  percent_complete INTEGER,
  pages_viewed INTEGER[],
  last_accessed TIMESTAMP,
  UNIQUE(user_id, document_id)
);

-- Download logs
CREATE TABLE download_logs (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  timestamp TIMESTAMP
);

-- AI chat history (optional)
CREATE TABLE chat_history (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  document_id VARCHAR(50),
  role VARCHAR(20), -- 'user' or 'assistant'
  message TEXT,
  timestamp TIMESTAMP
);
```

-----

## IMPLEMENTATION TIMELINE

**Total build time: 6-8 hours**

### **Phase 1 (Core - 2-3 hours):**

1. PDF.js setup with dark mode (30 min)
1. Progress syncing (30 min)
1. Shimmer loading (15 min)
1. Download tracking (15 min)
1. Mobile optimization (45 min)

### **Phase 2 (Premium - 3-4 hours):**

1. Page bookmarks (60 min)
1. Text highlights (90 min)
1. Reading time estimate (15 min)
1. Completion tracking (45 min)

### **Phase 3 (AI Integration - 1 hour):**

1. Connect existing AI chatbot to PDF viewer (45 min)
1. PDF context injection (15 min)

-----

## REPLIT BUILD INSTRUCTION

```
BUILD PREMIUM PDF VIEWER FOR PORTAL

IMPLEMENTATION ORDER:

1. Set up PDF.js embedded viewer
   - Dark mode styling
   - Mobile responsive
   - Shimmer loading

2. Add progress syncing
   - Save scroll position to database
   - Restore on load
   - Show completion percentage

3. Add bookmarks feature
   - "Bookmark This Page" button
   - Save to database
   - Bookmarks sidebar with jump-to-page
   - Delete bookmarks

4. Add highlights feature
   - Text selection highlighting
   - Save highlighted text to database
   - Highlights sidebar
   - Re-apply highlights on page load

5. Add reading time estimate
   - Calculate based on page count
   - Display in header

6. Add completion tracking
   - Track viewed pages
   - Calculate percentage
   - Progress bar UI
   - Completion badge when 100%

7. Integrate AI chatbot
   - Sidebar chat interface
   - Connect to existing chatbot endpoint
   - Pass PDF context (document ID, current page)
   - Display AI responses
   - Mobile: fullscreen overlay

8. Create database tables:
   - user_progress
   - bookmarks
   - highlights
   - user_completion
   - download_logs
   - chat_history (optional)

DESIGN:
- Match landing page aesthetic (dark, teal, minimal pink)
- All fonts: Inter
- Teal primary (#14B8A6)
- Pink accents (#EC4899) sparingly
- Dark backgrounds (#0a0a0a, #1a1a1a)

MOBILE:
- PDF scales to screen width
- Chat becomes fullscreen overlay
- Bookmarks/highlights accessible via menu
- Touch-friendly buttons (44px minimum)

Build time: 6-8 hours
Priority: High (premium user experience)

Use all code examples provided above.
```

-----

This is the complete, production-ready spec.

All features are implementable NOW.

Ship it.